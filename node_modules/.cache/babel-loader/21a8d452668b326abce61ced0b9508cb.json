{"ast":null,"code":"import jwtDecode from'jwt-decode';import config from'../config';var _timeoutId;var _TEN_SECONDS_IN_MS=10000;var TokenService={saveAuthToken:function saveAuthToken(token){window.localStorage.setItem(config.TOKEN_KEY,token);},getAuthToken:function getAuthToken(){return window.localStorage.getItem(config.TOKEN_KEY);},clearAuthToken:function clearAuthToken(){window.localStorage.removeItem(config.TOKEN_KEY);},hasAuthToken:function hasAuthToken(){return!!TokenService.getAuthToken();},makeBasicAuthToken:function makeBasicAuthToken(userName,password){return window.btoa(\"\".concat(userName,\":\").concat(password));},parseJwt:function parseJwt(jwt){return jwtDecode(jwt);},readJwtToken:function readJwtToken(){return TokenService.parseJwt(TokenService.getAuthToken());},_getMsUntilExpiry:function _getMsUntilExpiry(payload){/*\r\n      payload is from the JWT\r\n      the `exp` value is in seconds, need to convert to ms, so * 1000\r\n      calculates the difference between now and when the JWT will expire\r\n    */return payload.exp*1000-Date.now();},queueCallbackBeforeExpiry:function queueCallbackBeforeExpiry(callback){/* get the number of ms from now until the token expires */var msUntilExpiry=TokenService._getMsUntilExpiry(TokenService.readJwtToken());/*\r\n      queue a callback that will happen 10 seconds before the token expires\r\n      the callback is passed in as an argument so could be anything,\r\n        in this app, the callback is for calling the refresh endpoint\r\n    */_timeoutId=setTimeout(callback,msUntilExpiry-_TEN_SECONDS_IN_MS);},clearCallbackBeforeExpiry:function clearCallbackBeforeExpiry(){clearTimeout(_timeoutId);}};export default TokenService;","map":{"version":3,"sources":["c:/Users/t73de/Desktop/Web-Dev-Toolkit-Client/src/services/token-service.js"],"names":["jwtDecode","config","_timeoutId","_TEN_SECONDS_IN_MS","TokenService","saveAuthToken","token","window","localStorage","setItem","TOKEN_KEY","getAuthToken","getItem","clearAuthToken","removeItem","hasAuthToken","makeBasicAuthToken","userName","password","btoa","parseJwt","jwt","readJwtToken","_getMsUntilExpiry","payload","exp","Date","now","queueCallbackBeforeExpiry","callback","msUntilExpiry","setTimeout","clearCallbackBeforeExpiry","clearTimeout"],"mappings":"AAAA,MAAOA,CAAAA,SAAP,KAAsB,YAAtB,CACA,MAAOC,CAAAA,MAAP,KAAmB,WAAnB,CAEA,GAAIC,CAAAA,UAAJ,CACA,GAAMC,CAAAA,kBAAkB,CAAG,KAA3B,CAEA,GAAMC,CAAAA,YAAY,CAAG,CACnBC,aADmB,wBACLC,KADK,CACE,CACnBC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4BR,MAAM,CAACS,SAAnC,CAA8CJ,KAA9C,EACD,CAHkB,CAInBK,YAJmB,wBAIJ,CACb,MAAOJ,CAAAA,MAAM,CAACC,YAAP,CAAoBI,OAApB,CAA4BX,MAAM,CAACS,SAAnC,CAAP,CACD,CANkB,CAOnBG,cAPmB,0BAOF,CACfN,MAAM,CAACC,YAAP,CAAoBM,UAApB,CAA+Bb,MAAM,CAACS,SAAtC,EACD,CATkB,CAUnBK,YAVmB,wBAUJ,CACb,MAAO,CAAC,CAACX,YAAY,CAACO,YAAb,EAAT,CACD,CAZkB,CAanBK,kBAbmB,6BAaAC,QAbA,CAaUC,QAbV,CAaoB,CACrC,MAAOX,CAAAA,MAAM,CAACY,IAAP,WAAeF,QAAf,aAA2BC,QAA3B,EAAP,CACD,CAfkB,CAgBnBE,QAhBmB,mBAgBVC,GAhBU,CAgBL,CACZ,MAAOrB,CAAAA,SAAS,CAACqB,GAAD,CAAhB,CACD,CAlBkB,CAmBnBC,YAnBmB,wBAmBJ,CACb,MAAOlB,CAAAA,YAAY,CAACgB,QAAb,CAAsBhB,YAAY,CAACO,YAAb,EAAtB,CAAP,CACD,CArBkB,CAsBnBY,iBAtBmB,4BAsBDC,OAtBC,CAsBQ,CACzB;;;;MAKA,MAAQA,CAAAA,OAAO,CAACC,GAAR,CAAc,IAAf,CAAuBC,IAAI,CAACC,GAAL,EAA9B,CACD,CA7BkB,CA8BnBC,yBA9BmB,oCA8BOC,QA9BP,CA8BiB,CAClC,2DACA,GAAMC,CAAAA,aAAa,CAAG1B,YAAY,CAACmB,iBAAb,CACpBnB,YAAY,CAACkB,YAAb,EADoB,CAAtB,CAGA;;;;MAKApB,UAAU,CAAG6B,UAAU,CAACF,QAAD,CAAWC,aAAa,CAAG3B,kBAA3B,CAAvB,CACD,CAzCkB,CA0CnB6B,yBA1CmB,qCA0CS,CAC1BC,YAAY,CAAC/B,UAAD,CAAZ,CACD,CA5CkB,CAArB,CA+CA,cAAeE,CAAAA,YAAf","sourcesContent":["import jwtDecode from 'jwt-decode'\r\nimport config from '../config'\r\n\r\nlet _timeoutId\r\nconst _TEN_SECONDS_IN_MS = 10000\r\n\r\nconst TokenService = {\r\n  saveAuthToken(token) {\r\n    window.localStorage.setItem(config.TOKEN_KEY, token)\r\n  },\r\n  getAuthToken() {\r\n    return window.localStorage.getItem(config.TOKEN_KEY)\r\n  },\r\n  clearAuthToken() {\r\n    window.localStorage.removeItem(config.TOKEN_KEY)\r\n  },\r\n  hasAuthToken() {\r\n    return !!TokenService.getAuthToken()\r\n  },\r\n  makeBasicAuthToken(userName, password) {\r\n    return window.btoa(`${userName}:${password}`)\r\n  },\r\n  parseJwt(jwt) {\r\n    return jwtDecode(jwt)\r\n  },\r\n  readJwtToken() {\r\n    return TokenService.parseJwt(TokenService.getAuthToken())\r\n  },\r\n  _getMsUntilExpiry(payload) {\r\n    /*\r\n      payload is from the JWT\r\n      the `exp` value is in seconds, need to convert to ms, so * 1000\r\n      calculates the difference between now and when the JWT will expire\r\n    */\r\n    return (payload.exp * 1000) - Date.now()\r\n  },\r\n  queueCallbackBeforeExpiry(callback) {\r\n    /* get the number of ms from now until the token expires */\r\n    const msUntilExpiry = TokenService._getMsUntilExpiry(\r\n      TokenService.readJwtToken()\r\n    )\r\n    /*\r\n      queue a callback that will happen 10 seconds before the token expires\r\n      the callback is passed in as an argument so could be anything,\r\n        in this app, the callback is for calling the refresh endpoint\r\n    */\r\n    _timeoutId = setTimeout(callback, msUntilExpiry - _TEN_SECONDS_IN_MS)\r\n  },\r\n  clearCallbackBeforeExpiry() {\r\n    clearTimeout(_timeoutId)\r\n  },\r\n}\r\n\r\nexport default TokenService\r\n"]},"metadata":{},"sourceType":"module"}